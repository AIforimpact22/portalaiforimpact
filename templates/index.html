{% extends "base.html" %}
{% block title %}{{ course.title if course else 'Learning Portal' }}{% endblock %}

{% block hero %}
{% if course %}
<section class="spotlight-hero">
  <div class="container">
    <div class="spotlight-grid">
      <div class="spotlight-text">
        <div class="eyebrow">Master Course</div>
        <h1 class="spotlight-title">{{ course.title }}</h1>
        <p class="lead">{{ course.level }} Â· {{ course.category }}</p>

        <div class="hero-cta">
          <a class="btn" href="/learn/{{ course.id }}">Start learning</a>
          {% if first_uid %}
            <a class="btn ghost" id="continue-btn" href="/learn/{{ course.id }}/{{ first_uid }}">Continue</a>
          {% endif %}
        </div>

        <div class="stat-row">
          <div class="stat">
            <div class="num">{{ modules_count }}</div>
            <div class="label">Modules</div>
          </div>
          <div class="stat">
            <div class="num">{{ lessons_count }}</div>
            <div class="label">Sections</div>
          </div>
          <div class="stat">
            <div class="num">{{ duration_total }}</div>
            <div class="label">Total time</div>
          </div>
        </div>
      </div>

      <div class="spotlight-media">
        <img src="{{ course.thumbnail_url }}" alt="Course cover" />
      </div>
    </div>
  </div>
</section>
{% endif %}
{% endblock %}

{% block content %}
  {% if err %}<div class="alert error">Error: {{ err }}</div>{% endif %}

  <section id="curriculum" class="section card">
    <h2>Curriculum overview</h2>
    {% if weeks and weeks|length %}
      <ol class="timeline">
        {% for w in weeks %}
          <li class="timeline-item">
            <div class="dot"></div>
            <div class="content">
              <div class="week-title">{{ w.title }}</div>
              <div class="muted small">{{ w.lessons_count }} sections</div>
            </div>
          </li>
        {% endfor %}
      </ol>
      <div class="actions">
        <a class="btn" href="/learn/{{ course.id }}">Begin course</a>
      </div>
    {% else %}
      <p class="muted">The curriculum will appear here.</p>
    {% endif %}
  </section>

  <script>
    // Continue button -> last visited lesson (if available)
    (function(){
      try {
        var key = "progress_course_" + {{ course.id }};
        var uid = localStorage.getItem(key);
        if (uid) {
          var btn = document.getElementById('continue-btn');
          if (btn) btn.href = "/learn/{{ course.id }}/" + uid;
        }
      } catch(e){}
    })();
  </script>
{% endblock %}
